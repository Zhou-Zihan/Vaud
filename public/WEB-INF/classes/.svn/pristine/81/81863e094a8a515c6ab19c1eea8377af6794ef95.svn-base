package vaud.data.util;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStreamReader;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;

import vaud.data.datastructure.Weibo;
import vaud.data.datastructure.weather;

public class WeiboParse {
	
	static ArrayList<String> paths = new ArrayList<String>();
	public static String path = "data//Weibo";
	
	public static void GetAllPath(String path) {
		File file = new File(path);
		File[] files = file.listFiles();
		for(File fl : files){
			if(fl.isDirectory())
			{
				GetAllPath(fl.toString());
			} else {
				paths.add(fl.getPath());
			}
		}
		
	}
	
	
	public static void main(String args[]) throws IOException{
		
		weiboInit();
		
	}
	
	public static ArrayList<Weibo> weiboInit() throws IOException{
		ArrayList<Weibo> ret=new ArrayList<Weibo>();
		SimpleDateFormat sdf=new SimpleDateFormat("yyyy-MM-dd HH:mm");
		GetAllPath(path);
		for(String onepath : paths){
			
			//System.out.println(onepath.substring(onepath.length()-14, onepath.length()-4));
			
			BufferedReader in = new BufferedReader(new InputStreamReader(new FileInputStream(onepath),"utf-8"));
			String putin;
			String[] split;
			while ((putin = in.readLine()) != null) {
				if (putin.equals("")||putin.length()<2) continue;
				
				split = putin.split("\\$");
				Weibo temp = new Weibo();
				temp.date=onepath.substring(onepath.length()-14, onepath.length()-4);
				if (split[0].substring(11, 12).equals("u") || split[0].substring(14, 16).equals("i\\")||
						split[0].substring(14, 16).equals("9\\")||split[0].substring(0,1).equals("?")) continue;
				//System.out.println(putin);
				
				temp.time=Integer.parseInt(split[0].substring(11, 13))*60+Integer.parseInt(split[0].substring(14, 16));
				if (temp.time>1440) continue;
				try {
					temp.tdate=sdf.parse(split[0]);
				} catch (ParseException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}
				
				
				temp.name=split[1];
				temp.Ccontent=split[2];
				temp.PositionName=split[split.length-2];
				String[] split2=split[split.length-1].split("_");
				//System.out.println(putin);
				
				temp.lon=Double.parseDouble(split2[0]);
				temp.lat=Double.parseDouble(split2[1]);
				
				//System.out.println(putin);
				ret.add(temp);
			}
			in.close();
		}
		//System.out.println(ret.size());
		return ret;
	}

}
